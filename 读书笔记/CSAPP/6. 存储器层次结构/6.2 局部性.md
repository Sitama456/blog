## 6.2 局部性
终于介绍到程序一个很重要的属性了——局部性。一个局部性良好的程序更倾向于引用邻近于其他最近引用过的数据项的数据项，或者最近引用过的数据项本身。这种倾向性，被称为`局部性原理(principle of locality)`。局部性通常有两种形式：`时间局部性(temporal locality)`和`空间局部性(spatial locality)`。被引用过一次的内存位置很可能在不远的将来再被多次引用，被引用了一次的内存位置再不远的将来再被引用到。

### 6.2.1 对程序数据引用的局部性
下图中的简单函数，对一个向量的元素求和。在这个例子中，变量sum在每次循环迭代中被引用一次，因此有好的时间局部性。因为sum是标量，没有空间局部性。
![](pic/6.2%20局部性/求和函数.png)
对于向量v来说，它的元素是被顺序读取的，因此具有很好的空间局部性。但时间局部性很差，因为每个元素只被访问一次。

像sumvec这样顺序访问一个向量每个元素的函数，具有步长为1的引用模式，又称为顺序引用模式。如果每隔k个元素进行访问，就称为步长为k的引用模式。一般来说，随着步长的增加，空间局部性下降。

对于引用多维数组的程序来说，步长是一个很重要的问题。
![](pic/6.2%20局部性/有良好空间局部性.png)
上图程序对二维数组的引用顺序是按照其在内存中的分布顺序，所以具有良好的空间局部性。而对程序做一些很小的改动，就会对局部性有很大的影响。
![](pic/6.2%20局部性/局部性差的程序.png)
将i和j的顺序交换，它的空间局部性就很差，因为它是按照列顺序来扫描数组，而不是按照行顺序，结果得到步长为N的引用模式。

### 6.2.2 取指令的局部性
程序指令是存放在内存中的，CPU必须取出这些指令。例如上图中for循环体里的指令是按照连续的内存顺序执行的，因此循环有良好的空间局部性。因为循环体会被执行多次，所以它也有很好的时间局部性。

代码区别于程序数据的一个重要属性是在运行时它是不能被修改的。当程序正在执行时，CPU只从内存中读出它的指令，很少会重写或修改这些指令。