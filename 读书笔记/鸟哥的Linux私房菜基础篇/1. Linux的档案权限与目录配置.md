## 1. Linux的档案与目录配置
Linux最优秀的地方，就在于他的多人多任务环境，为了让各个使用者具有较保密的档案数据，档案的权限管理就变得很重要了。Linux一般将档案可存取的身份分为三个类别，分别是`owner/group/others`，且三种身份各有read/write/execute等权限。在Linux下这么多的目录/档案，代表什么意义呢？接下来将一一介绍。

### 1. 拥有者与群组
1. 文件拥有者。因为Linux是多人多任务的系统，因此可能常常会有多人同时使用这台主机进行工作。为了考虑每个人的隐私权以及每个人喜好的工作环境，文件拥有者这个角色就十分重要了。
2. 群组概念。群组最有用的功能之一，就是共享团队的开发资源。假设有两个团队，分别为projecta和projectb。每个团队有三个人，从class1到class6。由于协调和沟通的需要，组内成员之间必须要能够互相修改对方的数据，但是其他组的组员不能看到本组的档案内容。
3. 其他人。除了拥有者和群组之外的用户，对于这个文件就属于其他人的分类。

拥有者身份，与该拥有者所支持的群组概念，在Linux的世界里面是相当重要的。

#### Linux 用户身份与群组记录的文件
在Linux系统中，默认情况下，所有的系统上的账号与一般的身份使用者，还有那个root的相关信息，都是记录在/etc/passwd这个文件中的。至于个人密码则是记录在/etc/shadow这个文件。此外，Linux所有的组名都记录在/etc/group内。这三个文件可以说是Linux系统里面账号、密码、群组信息的集中地。

### 2 Linux 文件权限概念
文件的权限要如何针对这些所谓的使用者与群组来设定呢？这个部分是相当重要的。尤其对于初学者来说，因为文件的权限与属性是学习Linux的一个相当重要的关卡，如果没有这部分的概念，那么你将老是听不懂别人在讲什么！尤其是在控制台中出现了 Permission deny 的时候，肯定是权限设定错误。

#### 2.1 Linux 文件属性
登入Linux系统后，使用命令`ls -al`，可以看到下列信息：
```console
drwx------  4 root root 4096 1月   2 23:08 .
drwxr-xr-x 20 root root 4096 8月  25 14:38 ..
-rw-------  1 root root  877 1月   2 23:08 .bash_history
-rw-r--r--  1 root root 3106 12月  5  2019 .bashrc
drwx------  2 root root 4096 2月  10  2021 .cache
...
```
对于每一条的记录，它的含义为：


```console
-rw-r--r--      1       root        root           3106     12月  5  2019        .bashrc
文件类型权限     链接数   文件拥有者   文件所属群组    文件大小  文件最中被修改的时间  文件名
```
##### 文件类型与权限
仔细看，在第一栏其实共有十个字符。
```shell
    -           rwx             rwx                 ---
#   文件类型     拥有者权限       所属群组权限         其他人权限

# r = 可读    w = 可写      x = 可执行
```
其中，Linux的文件类型分为：
- `d` 目录
- `-` 文件
- `l` 软连接或硬链接
- `b` 可随机存取设备，块设备
- `c` 串口设备，例如键盘、鼠标(一次性读取)

##### 链接数
第二栏表示有多少的文件名链节到该节点(i-node)。每个文件都会将它的权限和属性记录到文件系统的i-node中。不过，我们使用的目录树是使用文件名记录，所以每个文件名就会链接到一个i-node上。

##### 文件拥有者
第三栏表示的是文件所属的拥有者账号。

##### 所属群组
第四栏表示所属群组。Linux系统中，账号会属于一个或多个群组中。文件所属群组中的所有成员都对该文件享有同样的权限。

##### 文件大小
第五栏表示的是文件大小，单位为bytes。

##### 修改时间
第六栏表示的是文件最近的修改时间。这一栏的内容分别文日期(月/日)及时间。如果这个档案被修改的时间距离现在太久了，那么仅显示年份。如果想要显示完整的时间格式，可以使用ls的选项：`ls -l --full-tile`。

##### 文件名
第七栏显示的就是文件名了。如果在文件名前多一个`.`，则代表这个文件是隐藏文件，需要`ls -a`才会显示。

#### 2.2 如何改变文件属性
既然文件权限对于一个系统的安全性很重要，那么如何修改一个文件的属性与权限呢？又有多少文件的权限可以修改呢？下面几个是常用于群组、拥有者、各种身份的权限的修改的指令

##### chgrp 改变文件所属群组
改变文件所属与的群组使用的是`chgrp`(change group)命令。不过，要被修改的组名必须在`/etc/group`文件中存在才行，否则会显示错误。假设有一个文件`test.txt`:
```console
# ls -al | grep test
-rw-r--r--  1 root root    0 1月   7 12:20 test.txt
```
更改它的所属组：
```console
# chgrp mzm test.txt
root@worker:~# ls -al | grep test
-rw-r--r--  1 root mzm     0 1月   7 12:20 test.txt
```
但是如果被修改的组不再`/etc/group`中，就会出错：
```console
# chgrp tejin test.txt
chgrp: 无效的组：“tejin”
```

##### chown 改变文件拥有者
使用命令`chown`(change owner)改变文件拥有者。要注意的是用户必须是以及存在系统中的账号，也就是在/etc/passwd这个文件中有记录的名称才能改变。
实际上，chown还可以顺便修改群组。如果要将目录下所有子目录或文件同时更改档案拥有者的化，直接加上-R选项即可。
```console
用法：
# chown [-R] 账号名称 文件或目录
# chown [-R] 账号名称 文件或目录

选项和参数：
-R: 进行递归的持续变更

例子，将test.txt的拥有者改为mzm这个账号
# chown mzm test.txt
#ls -l | grep test

-rw-r--r-- 1 mzm  mzm     0 1月   7 12:20 test.txt

将test.txt改回root:
# chown root:root test.txt
# ls -l | grep test

-rw-r--r-- 1 root root    0 1月   7 12:20 test.txt
```
那么什么时候要使用`chown`或`chgrp`呢？最常见的例子就是在复制文件给你之外的其他人时。

##### chmod 改变权限
使用命令`chmod`改变文件的权限。设置权限的方法有两种，分别可以使用数字或者是符号来进行权限的变更。
- 数字类型改变文件权限。Linux文件的基本权限就有九个，分别是`owner/group/others`三种身份各有自己的`read/write/excute`权限。在文件信息中，文件的权限字符为：`-rwxrwxrwx`。这九个权限是三个三个一组的，我们可以用数字来代表各个权限：
  - `r`:4
  - `w:`2
  - `x`:1
  每种身份各自的三个权限是需要累加的，例如当权限为`-rwxrwx---`时，各个身份的权限为：
  - owner = rwx = 4 + 2 + 1 = 7
  - group = rwx = 4 + 2 + 1 = 7
  - others = --- = 0 + 0 + 0 = 0
  指令`chmod`的语法是这样的:
  ```console
  # chmod [-R] xyz 文件或目录
  选项与参数：
  xyz: 就是数字类型的权限属性，为rwx属性数值的相加
  -R: 进行递归的持续变更
  ```
- 符号类型改变文件权限
  另一种改变权限的方法就是使用符号。基本上就九个权限分别是`user` `group` `others`三种身份。可以藉由`u` `g` `o`来代表三种身份的权限，此外，`a`可以表示`all`即全部的身份。读写可执行的权限就由`r``w``x`表示。则语法为：
  ```shell
  chmod (u | g | o | a ) (+ | - | =) (r | w | x) 文件或目录 
  参数：
  + ： 增加
  - ： 减少
  = ： 设定
  ```

#### 2.3 目录与文件的权限意义
##### 文件权限
文件是实际保存数据的地方，包括一般的文本文件、数据库内容文件、二进制可执行文件等等。因此，权限对于文件来说，它的意义是这样的：
- `r`(read) 可读取这一文件的实际内容，如读取文本文件的文字内容的等。
- `w`(write) 可以编辑、新增或者是修改该文件的内容(但不含删除该文件)。
- `x`(execute) 该文件具有可以被系统执行的权限。

对于可执行权限需要小心，因为在Linux下，文件是否能被执行，是藉由文件是否具有x这个权限来决定的。Windows下是根据文件后缀名决定的。

如果你拥有一个文件的写(w)权限时，你就具有写入/编辑/新增/修改文件的内容的权限，但并不具备删除该文件本身的权限。对于文件的rwx来说，主要针对的是文件的内容，而不是文件本身。

#####  目录权限
那么目录呢？其实目录也可以理解为特殊的文件，它的内容就是普通的文件名和子目录。目录权限的意义是这样的：
- `r` 标识具有读取目录结构列表的权限。
- `w` 标识具有修改目录结构的权限。包括建立新的文件与目录、删除已经存在的文件与子目录(不论该文件或子目录权限为何)、将已存在的文件或目录进行重命名、移动该目录内的文件、子目录位置。
- `x` 目录执行记录文件名，目录的执行权限代表的是用户能否进入该目录成为工作目录的用途。比如cd指令。

因此，对于目录的`r`和`x`权限可以开放，但是`w`权限不能随便给。比如下面这个例子，先用`root`账户新建了`testing`目录和`testing`文件：
```console
root@worker:/home/mzm# cd /tmp/           <== 切换工作目录到/tmp
root@worker:/tmp# mkdir testing           <== 建立新目录
root@worker:/tmp# chmod 744 testing       <== 设置目录权限
root@worker:/tmp# touch testing/testing   <== 建立新的文件
root@worker:chmod 600 testing/testing     <== 设置新文件的权限
root@worker:/tmp# ls -ald testing testing/testing
drwxr--r-- 2 root root 4096 1月   7 23:27 testing
-rw------- 1 root root    0 1月   7 23:27 testing/testing
# 仔细看一下，目录的权限是744(rwx-r-r)，且所属群组与拥有者都是root
# 在这样的情况下，一般身份用户对这个目录/文件的权限为何？
```
上述例子中，一般用户拥有`r`权限，但是这样的权限使用者能做什么事呢？
```console
root@worker:/tmp# su mzm            <== 切换身份成为mzm
mzm@worker:/tmp$ ls -l testing/     <== 执行ls命令
ls: 无法访问 'testing/testing': 权限不够
总用量 0
-????????? ? ? ? ?             ? testing
# 因为mzm具有r的权限可以查询文件名。不过权限不足(没有x)，所以会有一堆问号

mzm@worker:/tmp$ cd testing/
bash: cd: testing/: 权限不够
# 因为不具有x权限，所以没有进入的权限
```
那么如果该目录属于用户本身，有会有什么权限呢？我们让`testing`目录变成用户的，用户能否在这个目录下删除文件呢？
```console
mzm@worker:/tmp$ sudo su      <== 切换为root用户
root@worker:/tmp# chown mzm testing/  <== 更改目录的拥有者为mzm
root@worker:/tmp# su mzm      <== 切换为mzm
mzm@worker:/tmp$ cd testing/  <== 可以进入testing目录了
mzm@worker:/tmp/testing$ ls -l  <== ls 也可以正常显示
总用量 0
-rw------- 1 root root 0 1月   7 23:27 testing <== 注意testing文件不是mzm的 
mzm@worker:/tmp/testing$ rm testing <== 看能不能删除这个文件
rm：是否删除有写保护的普通空文件 'testing'？ y
mzm@worker:/tmp/testing$ ls -l  <== 删除了
总用量 0
```
可以看到，虽然用户`mzm`不是`文件testing`的拥有者，但它是`目录testing`的拥有者，所以可以删除`文件testing`。那么，用户`mzm`能不能读取该文件呢？
```console
mzm@worker:/tmp/testing$ sudo su
root@worker:/tmp/testing# vi testing
root@worker:/tmp/testing# cat testing
hello world!
root@worker:/tmp/testing# chmod 600 testing
root@worker:/tmp/testing# su mzm
mzm@worker:/tmp/testing$ ls -l
总用量 4
-rw------- 1 root root 13 1月   7 23:42 testing
mzm@worker:/tmp/testing$ cat testing    <== 不能读取文件内容
cat: testing: 权限不够
```
可以看到，用户`mzm`不能读取`文件testing`的内容，但是它仍可以删除`文件testing`。

#### 2.4 Linux 文件种类与扩展名
##### 文件类型
Linux下一切皆文件，因此，连数据沟通的接口也有专属的文件在负责。Linux的文件类型真的很多，除了之前提到的普通文件(-)和目录(d)之外，还有那些类型的文件呢？
- `普通文件(regular file)` : 就是一般的存储文件，在有`ls -al`所显示的属性中，第一个属性为`-`。另外，根据文件的内容还可以分为：
  - 文本文件(ASCII)：是系统中最常见的文件类型，其内容可以为人类直接读到。
  - 二进制文件(binary)：一般的可知行文件就是二进制类型的。
  - 数据格式文件(data): 有些程序中会读取某些特定格式的文件。
- `目录(directory)`：第一个属性为`d`。
- `链接文件(link)`：分为软硬链接，类似于Windows的快捷方式。第一个属性为`l`。
- `设备(divice)`：系统设备比如硬盘、键盘、鼠标的抽象。对于`块设备(硬盘)`，第一个属性为`b`，对于`字符设备(键盘)`，第一个属性为`c`。
- `接口文件(sockets)`：与网络进行通信的socket文件，第一个属性为`s`。
- `数据传送文件(FIFO,pipe)`：主要目的是解决多个应用程序数据传递问题。第一个属性为`p`。

##### 文件扩展名
基本上，Linux的文件是没有所谓的扩展名的。一个Linux文件能够执行的操作，只和它的第一栏的十个属性有关，与文件名根本一点关系都没有。不过，为了方便理解，一些程序还是会为它们处理的文件加上扩展名，以标识该文件是什么种类的。常用的扩展名如下：
- `*.sh`: shell脚本文件。
- `*.Z *.tar *.tar.gz *.zip *.tgz`: 经过压缩的打包文件。
- `*.html *.php`: 网页文件。

##### 文件名长度限制
在Linux下，使用预设的Ext2/Ext3/Ext4文件系统时，文件名长度限制为：
- 单个文件或目录的最大容许文件名为255个字符。
- 包含完整路径名称及目录(/)的文件名为4096个字符。
基本上时相当长的文件名了。如果希望通过文件名就能看出该文件时干嘛的，文件名就需要尽可能详细。

##### 文件名字符限制
由于Linux在文字接口下的一些执行和操作的关系，一般来说，在设定文件名时，最好可以避免一些特殊字符，比如`*?><;&|\'"'(){}`这些。因为这些字符是有特殊意义的。